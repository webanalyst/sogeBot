<template>
  <div class="col">
    <div
      v-if="state < 2"
      class="widgetAdd"
      @click="load"
    >
      <span v-if="state === 0">
        <fa icon="plus" /> {{ translate('add-widget') }}
      </span>
      <span v-if="state === 1">
        <fa
          icon="spinner"
          spin
        /> Loading data from server.
      </span>
    </div>
    <div
      v-else
      class="list-group"
    >
      <a
        v-for="widget of widgets"
        :key="widget.id"
        href="#"
        class="list-group-item list-group-item-action"
        @click="add(widget.id)"
      >
        <fa
          :icon="widget.icon.split(' ').map(o => o.replace('fa-', ''))"
          fixed-width
        />
        <span>{{ translate(widget.name).toUpperCase() }}</span>
      </a>
      <a
        href="#"
        class="list-group-item list-group-item-action"
        @click="state = 0"
      >
        <fa
          icon="times"
          fixed-width
        />
        <span style="font-size:1rem; text-transform:uppercase;">{{ translate('close') }}</span>
      </a>
    </div>
  </div>
</template>

<script>
import { getSocket } from '@sogebot/ui-helpers/socket';
import translate from '@sogebot/ui-helpers/translate';

export default {
  props: ['dashboardId'],
  data:  function () {
    return {
      translate,
      socket:  getSocket('/'),
      widgets: [],
      state:   0,
    };
  },
  methods: {
    add: function (widgetId) {
      this.socket.emit('addWidget', widgetId, this.dashboardId, () => {
        this.$emit('addWidget');
      });
      this.state = 0;
    },
    load: function () {
      this.state = 1;
      this.socket.emit('panel::availableWidgets', { userId: this.$store.state.loggedUser.id, type: 'admin' }, (err, widgets) => {
        if (err) {
          return console.error(err);
        }
        this.widgets = widgets;
        this.state = 2;
      });
    },
  },
};
</script>
